<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Cek Status Nomor Tri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f4f7;
    padding: 20px;
}
.container {
    max-width: 900px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
}
textarea {
    width: 100%;
    height: 200px;
    padding: 10px;
}
button, select {
    padding: 10px;
    margin-top: 10px;
}
button {
    background: #0070f3;
    color: #fff;
    border: none;
    cursor: pointer;
}
button:hover {
    background: #0059c1;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}
th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}
th {
    background: #0070f3;
    color: #fff;
}
.status-AKTIF {
    color: green;
    font-weight: bold;
}
.status-TIDAK {
    color: red;
    font-weight: bold;
}
.duplikat {
    background: #ffe5e5;
    color: red;
}
.info {
    margin-top: 10px;
    font-weight: bold;
}
.actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}
</style>
</head>

<body>
<div class="container">
<h1>Cek Status Nomor Tri</h1>

<textarea id="nomor" placeholder="0895330106330
0895330106330
085712345678"></textarea>

<div class="actions">
    <button onclick="cekNomor()">Cek Nomor</button>

    <select id="filter" onchange="renderTable()">
        <option value="ALL">Semua</option>
        <option value="AKTIF">AKTIF</option>
        <option value="TIDAK">TIDAK TERDAFTAR</option>
    </select>

    <button onclick="copyAktif()">Copy Nomor AKTIF</button>
</div>

<div id="info" class="info"></div>
<div id="hasil"></div>
</div>

<script>
let results = [];

function cekNomor() {
    const textarea = document.getElementById("nomor");
    const lines = textarea.value.split("\n");

    let allNumbers = [];
    let uniqueNumbers = [];
    let countMap = {};
    let set = new Set();

    // NORMALISASI
    lines.forEach(n => {
        n = n.trim();
        if (!n) return;

        n = n.replace(/\D/g, "");
        if (n.startsWith("08")) n = "62" + n.substring(1);

        allNumbers.push(n);
        countMap[n] = (countMap[n] || 0) + 1;

        if (!set.has(n)) {
            set.add(n);
            uniqueNumbers.push(n);
        }
    });

    textarea.value = uniqueNumbers.join("\n");

    // SIMULASI CEK STATUS
    results = uniqueNumbers.map(n => {
        return {
            nomor: n,
            status: Math.random() > 0.3 ? "AKTIF" : "TIDAK"
        };
    });

    renderTable(allNumbers, countMap);
}

function renderTable(allNumbers = [], countMap = {}) {
    const filter = document.getElementById("filter").value;
    const hasil = document.getElementById("hasil");

    let html = `
    <table>
        <tr>
            <th>No</th>
            <th>Nomor</th>
            <th>Status</th>
            <th>Info</th>
        </tr>
    `;

    let i = 1;
    let aktif = 0;

    results.forEach(r => {
        if (filter !== "ALL" && r.status !== filter) return;

        if (r.status === "AKTIF") aktif++;

        const isDup = countMap[r.nomor] > 1;

        html += `
        <tr class="${isDup ? 'duplikat' : ''}">
            <td>${i++}</td>
            <td>${r.nomor}</td>
            <td class="status-${r.status}">${r.status}</td>
            <td>${isDup ? 'Duplikat dihapus' : '-'}</td>
        </tr>
        `;
    });

    html += `</table>`;
    hasil.innerHTML = html;

    document.getElementById("info").innerText =
        `Total input: ${allNumbers.length} | Unik: ${results.length} | AKTIF: ${aktif}`;
}

function copyAktif() {
    let aktif = results
        .filter(r => r.status === "AKTIF")
        .map(r => r.nomor)
        .join("\n");

    navigator.clipboard.writeText(aktif);
    alert("Nomor AKTIF berhasil dicopy!");
}
</script>
</body>
</html>
