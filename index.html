<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Cek Status Nomor Tri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f4f7;
    padding: 20px;
}
.container {
    max-width: 1000px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
}
textarea {
    width: 100%;
    height: 200px;
    padding: 10px;
}
.actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;
}
button, select {
    padding: 10px;
}
button {
    background: #0070f3;
    color: #fff;
    border: none;
    cursor: pointer;
}
button:hover {
    background: #0059c1;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}
th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}
th {
    background: #0070f3;
    color: #fff;
}
.status-AKTIF {
    color: green;
    font-weight: bold;
}
.status-TIDAK {
    color: red;
    font-weight: bold;
}
.duplikat {
    background: #ffe5e5;
}
.info {
    margin-top: 10px;
    font-weight: bold;
}
</style>
</head>

<body>
<div class="container">
<h1>Cek Status Nomor Tri</h1>

<textarea id="nomor" placeholder="08953301063324
08953301063324
085712345678"></textarea>

<div class="actions">
    <button onclick="cekNomor()">Cek Nomor</button>

    <select id="filter" onchange="renderTable()">
        <option value="ALL">Semua Kode</option>
        <option value="200">Kode 200 (AKTIF)</option>
        <option value="404">Kode 404 (TIDAK TERDAFTAR)</option>
    </select>

    <button onclick="copyAktif()">Copy AKTIF</button>
</div>

<div id="info" class="info"></div>
<div id="hasil"></div>
</div>

<script>
let results = [];
let allNumbers = [];
let countMap = {};

function formatDate(d) {
    const months = ["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];
    return `${String(d.getDate()).padStart(2,'0')}-${months[d.getMonth()]}-${String(d.getFullYear()).slice(-2)}`;
}

// generate expiry 6â€“24 bulan ke depan
function generateExpiry() {
    const d = new Date();
    d.setMonth(d.getMonth() + Math.floor(Math.random() * 18) + 6);
    return formatDate(d);
}

function cekNomor() {
    const textarea = document.getElementById("nomor");
    const lines = textarea.value.split("\n");

    allNumbers = [];
    countMap = {};
    let unique = [];
    let set = new Set();

    // NORMALISASI
    lines.forEach(n => {
        n = n.trim();
        if (!n) return;

        n = n.replace(/\D/g, "");
        if (n.startsWith("08")) n = "62" + n.substring(1);

        allNumbers.push(n);
        countMap[n] = (countMap[n] || 0) + 1;

        if (!set.has(n)) {
            set.add(n);
            unique.push(n);
        }
    });

    textarea.value = unique.join("\n");

    // SIMULASI STATUS
    results = unique.map(n => {
        const aktif = Math.random() > 0.3;
        return {
            nomor: n,
            status: aktif ? "AKTIF" : "TIDAK TERDAFTAR",
            kode: aktif ? 200 : 404,
            expired: aktif ? generateExpiry() : "-"
        };
    });

    renderTable();
}

function renderTable() {
    const filter = document.getElementById("filter").value;
    const hasil = document.getElementById("hasil");

    let html = `
    <table>
        <tr>
            <th>No</th>
            <th>Nomor</th>
            <th>Status</th>
            <th>Tanggal Kadaluarsa</th>
            <th>Kode</th>
        </tr>
    `;

    let no = 1;
    let aktifCount = 0;

    results.forEach(r => {
        if (filter !== "ALL" && String(r.kode) !== filter) return;

        if (r.kode === 200) aktifCount++;

        const isDup = countMap[r.nomor] > 1;

        html += `
        <tr class="${isDup ? 'duplikat' : ''}">
            <td>${no++}</td>
            <td>${r.nomor}</td>
            <td class="status-${r.kode === 200 ? 'AKTIF' : 'TIDAK'}">${r.status}</td>
            <td>${r.expired}</td>
            <td>${r.kode}</td>
        </tr>
        `;
    });

    html += `</table>`;
    hasil.innerHTML = html;

    document.getElementById("info").innerText =
        `Total input: ${allNumbers.length} | Unik: ${results.length} | AKTIF (200): ${aktifCount}`;
}

function copyAktif() {
    const aktif = results
        .filter(r => r.kode === 200)
        .map(r => r.nomor)
        .join("\n");

    navigator.clipboard.writeText(aktif);
    alert("Nomor AKTIF (200) berhasil dicopy");
}
</script>
</body>
</html>
